function initRateListeners(){const t=document.querySelector(".rBtn"),e=document.querySelector(".rateIn"),s=document.querySelector(".ipc-button");t&&e&&t.addEventListener("click",t=>{t.stopPropagation(),e.classList.add("active")}),s&&e&&s.addEventListener("click",t=>{t.stopPropagation(),e.classList.remove("active")}),document.addEventListener("click",t=>{e&&!t.target.closest(".rateInC")&&e.classList.remove("active")})}initRateListeners(),function(){const t=document.querySelectorAll(".rStars button"),e=document.querySelector(".btnSm"),s=document.getElementById("rated-user"),i="M12 17.27l4.15 2.51c.76.46 1.69-.22 1.49-1.08l-1.1-4.72 3.67-3.18c.67-.58.31-1.68-.57-1.75l-4.83-.41-1.89-4.46c-.34-.81-1.5-.81-1.84 0L9.19 8.63l-4.83.41c-.88.07-1.24 1.17-.57 1.75l3.67 3.18-1.1 4.72c-.2.86.73 1.54 1.49 1.08l4.15-2.5z",c="M19.65 9.04l-4.84-.42-1.89-4.45c-.34-.81-1.5-.81-1.84 0L9.19 8.63l-4.83.41c-.88.07-1.24 1.17-.57 1.75l3.67 3.18-1.1 4.72c-.2.86.73 1.54 1.49 1.08l4.15-2.5 4.15 2.51c.76.46 1.69-.22 1.49-1.08l-1.1-4.73 3.67-3.18c.67-.58.32-1.68-.56-1.75zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z";t.forEach(r=>{r.addEventListener("click",function(){const r=parseInt(this.id.split("-").pop(),10);t.forEach((t,e)=>{const s=t.querySelector("svg path");e<r?(s.setAttribute("d",i),t.classList.add("is-filled")):(s.setAttribute("d",c),t.classList.remove("is-filled")),t.classList.remove("is-active")}),this.classList.add("is-active"),e.removeAttribute("disabled"),e.setAttribute("title",`Submitting Rating: ${r}`),s.setAttribute("data-text",r),s.setAttribute("title",`Selected Rating: ${r}`)}),r.addEventListener("mouseover",function(){const e=parseInt(this.id.split("-").pop(),10);t.forEach((t,s)=>{const r=t.querySelector("svg path");s<e?(r.setAttribute("d",i),t.classList.add("is-hover")):(r.setAttribute("d",c),t.classList.remove("is-hover"))})}),r.addEventListener("mouseout",function(){const e=parseInt(s.getAttribute("data-text"))||0;t.forEach((t,s)=>{const r=t.querySelector("svg path");s<e?(r.setAttribute("d",i),t.classList.add("is-filled")):(r.setAttribute("d",c),t.classList.remove("is-filled")),t.classList.remove("is-hover")})})})}();
function initRating(){const t=document.getElementById("rating");if(!t||!t.getAttribute("data-id"))return;const e=document.querySelectorAll(".rStars .btnS"),r=document.querySelector(".rated-caption"),o=document.querySelector(".btnSm"),a=document.querySelector(".starB"),i=document.getElementById("rated-user"),n=document.getElementById("total-ratings"),s=document.getElementById("average-rating"),c=document.querySelectorAll(".rating-progress"),d=t.getAttribute("data-id");let l=0,u=!1;const g="M12 17.27l4.15 2.51c.76.46 1.69-.22 1.49-1.08l-1.1-4.72 3.67-3.18c.67-.58.31-1.68-.57-1.75l-4.83-.41-1.89-4.46c-.34-.81-1.5-.81-1.84 0L9.19 8.63l-4.83.41c-.88.07-1.24 1.17-.57 1.75l3.67 3.18-1.1 4.72c-.2.86.73 1.54 1.49 1.08l4.15-2.5z";function f(t){let e=0;for(;;){const r="userVotedList"+(e||""),o=JSON.parse(localStorage.getItem(r)||"[]").find((e=>e.id===t));if(o)return o.userGivenStar;if(!localStorage.getItem(r))break;e++}return null}function m(t){e.forEach(((e,r)=>{const o=e.querySelector("svg path");r<t?(e.classList.add("is-active"),o.setAttribute("d",g)):e.classList.remove("is-active")})),i.setAttribute("data-text",t)}async function y(){try{const t=await fetch("https://raw.githubusercontent.com/flickmint/post-ratings-data/refs/heads/main/ratings-summary.json"),e=(await t.json()).find((t=>t.post_id===d));if(!e)return;n.setAttribute("data-text",e.total_votes);const r=10===e.avg_rating?"10":e.avg_rating.toFixed(1);s.setAttribute("data-text",r),c.forEach(((t,r)=>{const o=e["rate_count"+(r+1)]||0,a=e.total_votes?o/e.total_votes*100:0;t.querySelector(".progress-bar").style.width=a+"%";const i=t.querySelector(".progress-count");i&&i.setAttribute("data-text",o)}))}catch(t){console.error("Failed loading ratings summary:",t)}}function b(){const t=f(d);t&&(l=t,m(t),o.setAttribute("disabled","true"),r.classList.add("hidden"),a.setAttribute("disabled","true"),i.setAttribute("title",`You Rated: ${t}`))}window.updateRatingUI=b,b(),y(),t.addEventListener("click",(()=>{f(d)&&toastNotif.already("Voted already!")})),e.forEach(((t,e)=>{t.addEventListener("click",(()=>{f(d)||(l=e+1,m(l),o.removeAttribute("disabled"))}))})),o.addEventListener("click",(async()=>{if(u)toastNotif.loading("Working on it...");else if(f(d))toastNotif("Voted Already");else if(!(l<1))if("true"!==document.documentElement.getAttribute("data-is-incognito")){u=!0,toastNotif.loading("Verifying rating...");try{const t=await fetch("https://script.google.com/macros/s/AKfycbwfudUCPDB6OmbVFmIOB81DnOyMKo8cZ2eA85EYXiISJzYw63lZVuUoyGoPM_YkkZfa/exec",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({p_post_id:d,p_star_rating:l})}),e=await t.json();e.error?(console.error("Error saving rating:",e.error),toastNotif("Error saving rating!")):(toastNotif.success("Rating saved!"),function(t,e){let r=0;for(;;){const o="userVotedList"+(r||""),a=JSON.parse(localStorage.getItem(o)||"[]");if(!a.some((e=>e.id===t)))try{a.push({id:t,userGivenStar:e}),window.allowProtectedUpdate((()=>{localStorage.setItem(o,JSON.stringify(a))}))}catch(t){if("QuotaExceededError"===t.name){r++;continue}console.error("Error storing vote:",t)}break}}(d,l),o.setAttribute("disabled","true"),r.classList.remove("hidden"),a.setAttribute("disabled","true"),i.setAttribute("data-text",l),y(),window.updateUserVotes?.(),window.statsRatingFetched?.())}catch(t){console.error("Error with fetch:",t),toastNotif("Error saving rating!")}finally{u=!1}}else toastNotif.error("Not allowed in incognito mode!")}))}initRating();
function statsRatingFetched(){const t=document.getElementById("rating");if(!t)return;const e=t.getAttribute("data-id");fetch("https://raw.githubusercontent.com/flickmint/post-ratings-data/refs/heads/main/ratings-summary.json").then(t=>{if(!t.ok)throw new Error(`Network response was not ok (${t.status})`);return t.json()}).then(t=>{const r=t.find(t=>t.post_id===e);if(!r)return void console.error(`No rating record found for post_id=${e}`);const n=Array.from({length:10},(t,e)=>parseInt(r["rate_count"+(e+1)]||0)).reduce((t,e)=>t+e,0);let s='<table class="rating-stats"><thead><tr><th>Stars</th><th>Users Given</th><th>% Ratio</th></tr></thead><tbody>';for(let t=1;t<=10;t++){const e=parseInt(r["rate_count"+t]||0);s+=`<tr><td class="f ai-c jc-c gap-7"><span class="stIc"><svg class="px-18 svPC" viewBox="0 0 20 20" role="presentation"><path d="M9.10433 2.89874C9.47114 2.15549 10.531 2.1555 10.8978 2.89874L12.8282 6.81024L17.1448 7.43748C17.9651 7.55666 18.2926 8.56464 17.699 9.14317L14.5755 12.1878L15.3129 16.487C15.453 17.3039 14.5956 17.9269 13.8619 17.5412L10.0011 15.5114L6.14018 17.5412C5.40655 17.9269 4.54913 17.3039 4.68924 16.487L5.4266 12.1878L2.30308 9.14317C1.70956 8.56463 2.03708 7.55666 2.8573 7.43748L7.17389 6.81024L9.10433 2.89874Z"></path></svg></span><span class="sTxt">${t}</span></td><td>${e}</td><td>${n>0?(e/n*100).toFixed(2):"0.00"}%</td></tr>`}const a=parseFloat(r.avg_rating)||0,o=(a/10*100).toFixed(2);s+=`<tr><td>Avg</td><td>${function(t){return t>=1e9?(t/1e9).toFixed(1).replace(/\.0$/,"")+"B":t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString()}(n)} (Users)</td><td>${o}%</td></tr></tbody></table>`;const i=document.getElementById("rating-stats");i?i.innerHTML=s:console.error('No element with id="rating-stats"');const d=document.querySelector(".rRateGraph");if(d){d.innerHTML="";const t=document.createElement("canvas");t.width=100,t.height=100,d.appendChild(t);const e=t.getContext("2d"),r=50,n=50,s=40,o=-Math.PI/2,i=o+a/10*2*Math.PI;e.beginPath(),e.arc(r,n,s,0,2*Math.PI),e.strokeStyle="#f1f3f4",e.lineWidth=10,e.stroke(),e.beginPath(),e.arc(r,n,s,o,i),e.strokeStyle="#f97316",e.lineWidth=10,e.stroke(),e.font="16px Arial",e.fillStyle="#212121",e.textAlign="center",e.textBaseline="middle",e.fillText(a,r,n)}else console.error('No element with class="rRateGraph"')}).catch(t=>{console.error("Error loading or parsing ratings JSON:",t)})}window.statsRatingFetched=statsRatingFetched,statsRatingFetched();
!function(){function e(){const e=localStorage.getItem("userVotedList");if(!e)return;let t;try{t=JSON.parse(e)}catch(e){return void console.error("Error parsing userVotedList:",e)}t.forEach(e=>{if(!document.querySelector(`div[data-id="${e.id}"]`))return;const t=document.querySelector("#user-rated"),r=document.querySelector("#user-rate-value");t&&t.setAttribute("data-text","Yes"),r&&r.setAttribute("data-text",e.userGivenStar)})}window.updateUserVotes=e,e()}();
