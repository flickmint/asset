function initRateListeners(){const t=document.querySelector(".rBtn"),e=document.querySelector(".rateIn"),s=document.querySelector(".ipc-button");t&&e&&t.addEventListener("click",t=>{t.stopPropagation(),e.classList.add("active")}),s&&e&&s.addEventListener("click",t=>{t.stopPropagation(),e.classList.remove("active")}),document.addEventListener("click",t=>{e&&!t.target.closest(".rateInC")&&e.classList.remove("active")})}initRateListeners(),function(){const t=document.querySelectorAll(".rStars button"),e=document.querySelector(".btnSm"),s=document.getElementById("rated-user"),i="M12 17.27l4.15 2.51c.76.46 1.69-.22 1.49-1.08l-1.1-4.72 3.67-3.18c.67-.58.31-1.68-.57-1.75l-4.83-.41-1.89-4.46c-.34-.81-1.5-.81-1.84 0L9.19 8.63l-4.83.41c-.88.07-1.24 1.17-.57 1.75l3.67 3.18-1.1 4.72c-.2.86.73 1.54 1.49 1.08l4.15-2.5z",c="M19.65 9.04l-4.84-.42-1.89-4.45c-.34-.81-1.5-.81-1.84 0L9.19 8.63l-4.83.41c-.88.07-1.24 1.17-.57 1.75l3.67 3.18-1.1 4.72c-.2.86.73 1.54 1.49 1.08l4.15-2.5 4.15 2.51c.76.46 1.69-.22 1.49-1.08l-1.1-4.73 3.67-3.18c.67-.58.32-1.68-.56-1.75zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z";t.forEach(r=>{r.addEventListener("click",function(){const r=parseInt(this.id.split("-").pop(),10);t.forEach((t,e)=>{const s=t.querySelector("svg path");e<r?(s.setAttribute("d",i),t.classList.add("is-filled")):(s.setAttribute("d",c),t.classList.remove("is-filled")),t.classList.remove("is-active")}),this.classList.add("is-active"),e.removeAttribute("disabled"),e.setAttribute("title",`Submitting Rating: ${r}`),s.setAttribute("data-text",r),s.setAttribute("title",`Selected Rating: ${r}`)}),r.addEventListener("mouseover",function(){const e=parseInt(this.id.split("-").pop(),10);t.forEach((t,s)=>{const r=t.querySelector("svg path");s<e?(r.setAttribute("d",i),t.classList.add("is-hover")):(r.setAttribute("d",c),t.classList.remove("is-hover"))})}),r.addEventListener("mouseout",function(){const e=parseInt(s.getAttribute("data-text"))||0;t.forEach((t,s)=>{const r=t.querySelector("svg path");s<e?(r.setAttribute("d",i),t.classList.add("is-filled")):(r.setAttribute("d",c),t.classList.remove("is-filled")),t.classList.remove("is-hover")})})})}();
function initRating(){const t=document.getElementById("rating");if(!t||!t.getAttribute("data-id"))return;const e="https://script.google.com/macros/s/AKfycbwfudUCPDB6OmbVFmIOB81DnOyMKo8cZ2eA85EYXiISJzYw63lZVuUoyGoPM_YkkZfa/exec",r=document.querySelectorAll(".rStars .btnS"),o=document.querySelector(".rated-caption"),a=document.querySelector(".btnSm"),i=document.querySelector(".starB"),n=document.getElementById("rated-user"),s=t.getAttribute("data-id");let c=0;const d="M12 17.27l4.15 2.51c.76.46 1.69-.22 1.49-1.08l-1.1-4.72 3.67-3.18c.67-.58.31-1.68-.57-1.75l-4.83-.41-1.89-4.46c-.34-.81-1.5-.81-1.84 0L9.19 8.63l-4.83.41c-.88.07-1.24 1.17-.57 1.75l3.67 3.18-1.1 4.72c-.2.86.73 1.54 1.49 1.08l4.15-2.5z";function u(){const t=f(s);t&&(l(c=t),n.setAttribute("data-text",c),n.setAttribute("title",`You Rated: ${c}`),a.setAttribute("disabled","true"),o.classList.add("hidden"),i.setAttribute("disabled","true"))}function l(t){r.forEach((e,r)=>{const o=e.querySelector("svg path");r<t?(e.classList.add("is-active"),o.setAttribute("d",d)):e.classList.remove("is-active")}),n.setAttribute("data-text",t)}async function g(t){try{const r=await fetch(`${e}?p_post_id=${t}`),o=await r.json(),a=[o.rate_count1,o.rate_count2,o.rate_count3,o.rate_count4,o.rate_count5,o.rate_count6,o.rate_count7,o.rate_count8,o.rate_count9,o.rate_count10],i=a.reduce((t,e)=>t+e,0),n=a.reduce((t,e,r)=>t+e*(r+1),0),s=i>0?n/i:0;document.getElementById("total-ratings").setAttribute("data-text",i);const c=document.getElementById("average-rating"),d=10===s?"10":s.toFixed(1);c.setAttribute("data-text",d);const u=document.querySelectorAll(".rating-progress");a.forEach((t,e)=>{const r=i>0?t/i*100:0;u[e].querySelector(".progress-bar").style.width=r+"%";const o=u[e].querySelector(".progress-count");o&&o.setAttribute("data-text",t)})}catch(t){console.error("Error fetching rating data:",t)}}function f(t){let e=0;for(;;){const r=(JSON.parse(localStorage.getItem("userVotedList"+(e||"")))||[]).find(e=>e.id===t);if(r)return r.userGivenStar;if(!localStorage.getItem("userVotedList"+(e||"")))break;e++}return null}window.updateRatingUI=u,u(),t.addEventListener("click",()=>{f(s)&&toastNotif.already("Voted already!")}),r.forEach((t,e)=>{t.addEventListener("click",()=>{f(s)||(l(c=e+1),a.removeAttribute("disabled"))})}),a.addEventListener("click",async()=>{if("true"===document.documentElement.getAttribute("data-is-incognito"))toastNotif.error("Not allowed in incognito mode!");else if(!f(s)&&c>0){toastNotif.loading("Verifying rating...");try{const t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({p_post_id:s,p_star_rating:c})}),r=await t.json();r.error?(console.error("Error saving rating:",r.error),toastNotif("Error saving rating!")):(toastNotif.success("Rating saved!"),function(t,e){let r=0;for(;;){const o="userVotedList"+(r||"");let a=JSON.parse(localStorage.getItem(o))||[];const i=a.some(e=>e.id===t);if(i)break;try{a.push({id:t,userGivenStar:e}),window.allowProtectedUpdate(()=>{localStorage.setItem(o,JSON.stringify(a))});break}catch(t){if("QuotaExceededError"!==t.name){console.error("Error storing the vote:",t);break}r++}}}(s,c),g(s),n.setAttribute("data-text",c),a.setAttribute("disabled","true"),o.classList.remove("hidden"),i.setAttribute("disabled","true"),window.updateUserVotes(),window.statsRatingFetched())}catch(t){console.error("Error with fetch:",t),toastNotif("Error saving rating!")}}else toastNotif("Voted Already")}),g(s)}initRating();
!function(){const t=localStorage.setItem,e=localStorage.removeItem,o=(localStorage.clear,"userVotedList"),a={};let l=!1;function r(){for(let t=0;t<localStorage.length;t++){const e=localStorage.key(t);e.startsWith(o)&&!a.hasOwnProperty(e)&&(a[e]=localStorage.getItem(e))}}window.allowProtectedUpdate=function(t){l=!0,t(),l=!1},r(),localStorage.setItem=function(e,r){if(e.startsWith(o)){if(!l&&a.hasOwnProperty(e)&&a[e]!==r)return void console.warn(`Modification to protected key "${e}" is blocked!`);a[e]=r}t.apply(this,arguments)},localStorage.removeItem=function(t){t.startsWith(o)?console.warn(`Removal of protected key "${t}" is blocked!`):e.apply(this,arguments)},localStorage.clear=function(){console.warn("Clearing localStorage is blocked for protected keys!");const t=[];for(let e=0;e<localStorage.length;e++){const a=localStorage.key(e);a.startsWith(o)||t.push(a)}t.forEach(t=>e.call(localStorage,t))},setInterval(()=>{r(),Object.keys(a).forEach(t=>{localStorage.getItem(t)||(console.warn(`Protected key "${t}" missing, restoring it.`),window.allowProtectedUpdate(()=>{localStorage.setItem(t,a[t])}))})},1e3)}();
function statsRatingFetched(){const t=document.getElementById("rating");if(!t)return;const e=t.getAttribute("data-id"),r="https://script.google.com/macros/s/AKfycbwfudUCPDB6OmbVFmIOB81DnOyMKo8cZ2eA85EYXiISJzYw63lZVuUoyGoPM_YkkZfa/exec?p_post_id="+encodeURIComponent(e);fetch(r).then(t=>t.json()).then(t=>{if(t.error)return void console.error("Error from server:",t.error);const e=t;let r=0;for(let t=1;t<=10;t++)r+=parseInt(e["rate_count"+t]||0);let n='<table class="rating-stats">';n+="<tr><th>Stars</th><th>Users Given</th><th>% Ratio</th></tr>";for(let t=1;t<=10;t++){const a=parseInt(e["rate_count"+t]||0);n+=`<tr><td class="f ai-c jc-c gap-7"><span class="stIc"><svg class="px-18 svPC" viewBox="0 0 20 20" role="presentation"><path d="M9.10433 2.89874C9.47114 2.15549 10.531 2.1555 10.8978 2.89874L12.8282 6.81024L17.1448 7.43748C17.9651 7.55666 18.2926 8.56464 17.699 9.14317L14.5755 12.1878L15.3129 16.487C15.453 17.3039 14.5956 17.9269 13.8619 17.5412L10.0011 15.5114L6.14018 17.5412C5.40655 17.9269 4.54913 17.3039 4.68924 16.487L5.4266 12.1878L2.30308 9.14317C1.70956 8.56463 2.03708 7.55666 2.8573 7.43748L7.17389 6.81024L9.10433 2.89874Z"></path></svg></span><span class="sTxt">${t}</span></td><td>${a}</td><td>${r>0?(a/r*100).toFixed(2):"0.00"}%</td></tr>`}const a=((parseFloat(e.avg_rating)||0)/10*100).toFixed(2);n+=`<tr><td>Avg</td><td>${function(t){return t>=1e9?(t/1e9).toFixed(1).replace(/\.0$/,"")+"B":t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString()}(r)} (Users)</td><td>${a}%</td></tr>`,n+="</table>";const o=document.getElementById("rating-stats");o?(o.innerHTML="",o.insertAdjacentHTML("beforeend",n)):console.error('No element with id "rating-stats" found.');const s=document.querySelector(".rRateGraph");if(s){s.innerHTML="";const t=document.createElement("canvas");t.width=100,t.height=100,s.appendChild(t);const r=t.getContext("2d"),n=t.width/2,a=t.height/2,o=40,i=-Math.PI/2,c=parseFloat(e.avg_rating)||0,d=i+c/10*2*Math.PI;r.beginPath(),r.arc(n,a,o,0,2*Math.PI),r.strokeStyle="#f1f3f4",r.lineWidth=10,r.stroke(),r.beginPath(),r.arc(n,a,o,i,d),r.strokeStyle="#f97316",r.lineWidth=10,r.stroke(),r.font="16px Arial",r.fillStyle="#212121",r.textAlign="center",r.textBaseline="middle",r.fillText(c,n,a)}else console.error('No element with class "rRateGraph" found.')}).catch(t=>{console.error("Error fetching rating data:",t)})}window.statsRatingFetched=statsRatingFetched,statsRatingFetched();
!function(){function e(){const e=localStorage.getItem("userVotedList");if(!e)return;let t;try{t=JSON.parse(e)}catch(e){return void console.error("Error parsing userVotedList:",e)}t.forEach(e=>{if(!document.querySelector(`div[data-id="${e.id}"]`))return;const t=document.querySelector("#user-rated"),r=document.querySelector("#user-rate-value");t&&t.setAttribute("data-text","Yes"),r&&r.setAttribute("data-text",e.userGivenStar)})}window.updateUserVotes=e,e()}();
